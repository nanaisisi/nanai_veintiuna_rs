# 次期更新 (一時まとめ)

目的: 次期リリースで実装したい機能を短くまとめ、優先度と実装メモを残す。後で個別の issue / PR に分割する。

## 要件（ユーザーからの要望）

- プレイヤー操作を「選択肢を選ぶ形式」にする（メニュー式）
- プレイヤーが「定石選択肢」を選べるようにする（複数戦略プリセット）
- 賭け金の変更をメニューで可能にする
- ゲーム終了（Quit）選択肢を用意する
- セーブはオートセーブで良い（手動セーブ不要）

## 受け入れ基準（アウトカム）

- 起動後にメインメニューが表示され、選択肢で操作できること
- 定石プリセットを選ぶと、その戦略に従ってプレイが進むこと
- 賭け金は増減でき、次ラウンドに反映されること
- 終了選択で安全にゲームを終え、現在状態はオートセーブされること

## データ設計（提案）

- MenuChoice enum: {StartGame, SelectStrategy, ChangeBet, LoadSave, Quit}
- Strategy enum: {Basic, Conservative, Aggressive, Custom}
- PlayerState: {bank: i64, current_bet: i64, strategy: Strategy}
- Save format: TOML (既存設定と合わせる)、自動保存は PlayerState を `save/player_state.toml` に書く

## UI / フロー案（簡潔）

1. メインメニュー表示: Start / Strategy / Bet / Quit
2. Strategy ではプリセット一覧を表示し、選択で即時反映
3. Bet では +/- か金額入力で現在ベットを変更（規定範囲チェック）
4. Start でゲームループへ。ラウンド終了時に自動でセーブ。
5. Quit は確認プロンプトの後セーブして終了

## 実装メモとファイル変更提案

- `game.rs`: メニュー表示と入力パーサを追加。既存の `run_game` をラウンド単位の呼び出しに分離。
- `config.rs`/`game_config.toml`: Strategy とオートセーブ設定（true/false、保存先）を追加。
- `main.rs`: 起動時に状態ロード→メニュー表示→適切ハンドラへ遷移。
- セーブ処理は失敗をリトライし、失敗時はログを残す（秘密情報不要）。

### ゲーム性変更

- サレンダー: Early Surrender（早期サレンダー）の実装。基本戦略に従い、16 vs 9/10/A、15 vs 10 でサレンダー可能にする。

## エッジケースと検討点

- セーブ中にクラッシュした場合の部分書き込み対策（tmpファイルへ書いてから rename）
- 賭け金の下限/上限（負数禁止、銀行残高以上を禁止）
- マルチスレッドや並列性は当面不要。UI は同期的な CLI 前提。

## テスト案

- メニュー遷移のユニットテスト（選択肢→期待する状態遷移）
- セーブ/ロードの round-trip テスト
- Strategy が変更されたときの挙動スナップショットテスト

## 優先度（提案）

1. メニュー式操作（必須）
2. 定石プリセットの選択（必須）
3. 賭け金の変更（必須）
4. サレンダー（Early Surrender 前提）（必須）
5. オートセーブ（重要）
6. Quit 確認と安全な終了（重要）

---
メモ: これを元に小さな PR に分割できます。望むなら最初の PR（メニュー表示 + simple strategy 選択）を作成してコード変更を進めます。どれを優先しますか？
